<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Analytics API - Data</title>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' https://apis.google.com https://www.gstatic.com;">

</head>
<body>
    <h1>Google Analytics Data</h1>
    <canvas id="chart" width="400" height="200"></canvas>

    <script>
        const CLIENT_ID = '214036241518-be5frrk0bus3h05oo3dt6b2t1j19onr3.apps.googleusercontent.com';
        const API_KEY = 'AIzaSyAJugTkVuqv5BbYEPm9rr7U4mPSA5fvdmI';
        const SCOPES = 'https://www.googleapis.com/auth/analytics.readonly';

        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                discoveryDocs: ["https://analyticsdata.googleapis.com/$discovery/rest?version=v1"],
                scope: SCOPES
            }).then(() => {
                console.log("Google API initialized!");
                fetchAnalyticsData();
            }).catch(error => {
                console.error("Error initializing the Google API: ", error);
            });
        }

        function fetchAnalyticsData() {
            gapi.client.analyticsdata.properties.runReport({
                property: 'properties/443269906',  // Zamijenite sa svojim property ID-jem
                requestBody: {
                    dateRanges: [{ startDate: "30daysAgo", endDate: "today" }],
                    dimensions: [{ name: "country" }, { name: "deviceCategory" }, { name: "pagePath" }],
                    metrics: [{ name: "activeUsers" }, { name: "sessions" }, { name: "averageSessionDuration" }]
                }
            }).then(response => {
                console.log(response.result);
                renderChart(response.result); // Poziv za prikazivanje grafa
            }).catch(error => {
                console.error("Error fetching data: ", error);
            });
        }

        function renderChart(data) {
            const ctx = document.getElementById('chart').getContext('2d');
            const labels = data.rows.map(row => row.dimensionValues[0].value); // Zemlje
            const values = data.rows.map(row => row.metricValues[0].value); // Aktivni korisnici

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Active Users per Country',
                        data: values,
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        gapi.load("client:auth2", initClient);
    </script>
</body>
</html>
